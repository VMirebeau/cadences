<html>
  <head>
    <title>Jeu de tonalité et parcours harmonique</title>
    <script type="text/javascript">
      var ALLnotes = { "C": 0, "C#": 1, "Db": 1, "D": 2, "D#": 3, "Eb": 3, "E": 4, "F": 5, "F#": 6, "Gb": 6, "G": 7, "G#": 8, "Ab": 8, "A": 9, "A#": 10, "Bb": 10, "B": 11, "Cb": 11};
      var LISTE_NOTES = ["A", "B", "C", "D", "E", "F", "G"];
      var LISTE_DEG = [["I",0,0], ["BII",1,1], ["II",1,2], ["BIII",2,3], ["III",2,4], ["IV",3,5], ["V",4,7], ["BVI",5,8], ["VI",5,9], ["BVII",6,10], ["VII",6,11]];
      var GTONALITE = "";
      var GCADENCE = ["",""];
      var GCAD_REAL = "";
      var TNOTES = ["C", "G", "D", "A", "E", "B", "F#", "Db", "Ab", "Eb", "Bb", "F"];
var TCADENCES = [
  ["I ii IV V","Sorte de montée de la gamme majeure.<br><u>Morceaux célèbres :</u> Love is All Around (The Troggs), 99 Luftballons (Nena), Your Song (Elton John) <A href='https://youtu.be/cjOQIbkRQ-4?t=321'>[ECOUTER]</A>"],
  ["I IV I V","Combinaison de IV et de V permet de garder le mouvement<br><u>Morceaux célèbres :</u> The Lion Sleeps Tonight (The Tokens), MMMBop (Hanson) <A href='https://youtu.be/cjOQIbkRQ-4?t=492'>[ECOUTER]</A>"],
  ["I IV V IV","Progression simple mais efficace.<br><u>Morceaux célèbres :</u> Summer Nights (Grease), Wild Thing (The Troggs), Walking on Sunshine (Katrina & the Waves)"],
  ["I IV vi V","Mêmes accords de la progression Axis, mais dans un ordre différent. Change le mouvement de tension, avec la plus grande tension à la fin. Tension plus progressive. Couleur plus lumineuse.<br><u>Morceaux célèbres :</u> Mr Brightside (The Killers) <A href='https://youtu.be/9zbP0GQzUuI?t=423'>[ECOUTER]</A>"],
  ["I V ii IV","Ressemble à la progression Axis, mais le ii fait une grande différence. Le ii IV reste dans la même tension, mais avec une sensation de montée.<br><u>Morceaux célèbres :</u> Believe (Cher) <A href='https://youtu.be/v3YbEL-_eoI?t=456'>[ECOUTER]</A>"],
  ["I V IV V","Progression très pop, utilisée dans beaucoup de styles.<br><u>Morceaux célèbres :</u> MMMBop (Hanson) <A href='https://youtu.be/Vyc8lezaa9g?t=954'>[ECOUTER]</A>"],
  ["I V vi IV","Progression très utilisée entre les années 1980 et 2010, elle est au centre de la vidéo humoristique 'Axis of Awesome'. <br><u>Morceaux célèbres :</u> Let it be (The Beatles), Take on Me (A-Ha), Someone Like You (Adele), Can You Feel the Love Tonight (Elton Jones), Let it Go (La Reine des Neiges) <A href='https://youtu.be/Vyc8lezaa9g?t=168'>[ECOUTER]</A>"],
  ["I V bVII IV","Une quarte entre I et V, et aussi entre bVII et IV. Le bVII est un emprunt au mode mixolydien : son plus détendu.<br><u>Morceaux célèbres :</u> We Used to be Friends (The Dandy Warhols) <A href='https://youtu.be/cjOQIbkRQ-4?t=37'>[ECOUTER]</A>"],
  ["I vi IV V","La progression Doo-Wop / 50's.<br><u>Morceaux célèbres :</u> I Will Always Love You (Dolly Parton), Happiness Is a Warm Gun (The Beatles), Baby (Justin Bieber) <A href='https://youtu.be/Vyc8lezaa9g?t=793'>[ECOUTER]</A>"],
  ["I bVII IV I","Progression avec une sonorité myxolidienne, donnée par le bVII. Entre le bVII, le IV et le I on progresse par quartes.<br><u>Morceaux célèbres :</u> Hey Jude (The Beatles), Royals (Lorde), Sweet Home Alabama (Lynyrd Skynyrd) <A href='https://youtu.be/Vyc8lezaa9g?t=1087'>[ECOUTER]</A>"],
["i i bVI V","Le vamp mineur harmonique<br><u>Morceaux célèbres :</u> We Are Number One (Lazy Town), Seven Nation Army (The Whites Stripes), Havana, Toxicity (System of a Dumb), Sweet Dreams (Eurythmics), History Song (Good Bad & The Queen) <A href='https://youtu.be/9zbP0GQzUuI?t=33'>[ECOUTER]</A>"],
["i bIII bVII IV","La 'cascade plagale'. Fais un usage répété de la cadence plagale IV I.<br><u>Morceaux célèbres :</u> Wonderwall (Oasis), Radioactive (Imagine Dragons) <A href='https://youtu.be/v3YbEL-_eoI?t=114'>[ECOUTER]</A>"],
["i bVII v bVI","La progression 'Can't Stop'. Son très doux, aeolien.<br><u>Morceaux célèbres :</u> Can't Stop (Red Hop Chili Peppers), Hello (Adele), The Zephyr Song (Red Hot Chili Peppers) <A href='https://youtu.be/v3YbEL-_eoI?t=211'>[ECOUTER]</A>"],
["i bVII bVI V","'Cadence andalouse'. Mouvement clair de descente, avec une tension maximale à la fin.<br>Morceaux célèbres: Hit the Road Jack (Ray Charles), Happy Together (The Turtles) <A href='https://youtu.be/Vyc8lezaa9g?t=452'>[ECOUTER]</A>"],
["i bVII bVI bVII","Très proche de la cadence andalouse. Donne une couleur très aeolienne, plus suspendue que la cadence andalouse.<br>Morceaux célèbres : Rolling in the deep (Adele), All along the Watchtower (Jimy Hendrix), Stairway to Heaven (Led Zeppelin), My Heart Will Go On (Celine Dion), In the Air Tonight (Phil Collins) <A href='https://youtu.be/Vyc8lezaa9g?t=571'>[ECOUTER]</A>"],
["IV I V V","On commence par le IV : on sait déjà qu'on doit bouger. On termine sur le V qui force encore plus le mouvement<br><u>Morceaux célèbres :</u> Like a prayer (Madonna) <A href='https://youtu.be/cjOQIbkRQ-4?t=782'>[ECOUTER]</A>"],
["IV I V vi","Une variation de la progression Axis, mais qui commence avec la tension du IV.<br><u>Morceaux célèbres :</u> Umbrella (Rihanna), Dragostea Din Tei (O-zone) <A href='https://youtu.be/v3YbEL-_eoI?t=643'>[ECOUTER]</A>"],
["IV V I vi","La progression Viva la vida. Assez proche de la progression Doo-Wop, en commençant au milieu. Les deux premières montent, les deux dernières montent.<br><u>Morceaux célèbres :</u> Viva la vida (Coldplay), I wanna Hold Your Hand (The Beatles) <A href='https://youtu.be/9zbP0GQzUuI?t=184'>[ECOUTER]</A>"],
["vi IV I V","Une version modifiée de la progression Axis : on commence par le milieu. L'intérêt est que la plus grande tension est placée à la fin de la progression<br><u>Morceaux célèbres :</u> Numb (Linkin Park), Kids (MGMT), Africa (Toto), Complicated (Avril Lavigne), Save Tonight (Eagle Eye Cherry) <A href='https://youtu.be/Vyc8lezaa9g?t=251'>[ECOUTER]</A>"]
];

  function distanceEnDemiTon(note1, note2) {
    newNote = note1[0];
    var note1Value = ALLnotes[newNote];
    var note2Value = ALLnotes[note2];
    var distance = note2Value - note1Value;
    if (note1Value > note2Value) distance += 12;
    if (note1[1] === "#") {
        distance -= 1;
    } else if (note1[1] === "b") {
        distance += 1;
    }
    return distance;
  }
  
  function DEPLACER_NOTE(Note, nbNotes, dmTons)
  {
	var X = LISTE_NOTES.indexOf(Note[0]); // On repère la position X de la note, dans la liste des notes
    var NOUVELLE_NOTE = LISTE_NOTES[(X + nbNotes) % 7]; // On ajoute toutes les positions de notes, %7 pour boucler la série
    var DIFFERENCE = dmTons - distanceEnDemiTon(Note, NOUVELLE_NOTE); // On compare la distance entre le nombre de demi-tons qu'indique le degré en général (degreElement[2]) et la distance en demi-tons entre la note de la tonalité et la nouvelle note sur laquelle on arrive
	/*
		console.log ("degreElement[2] : " + degreElement[2]);
		console.log ("TONALITE : " + TONALITE + ", NOUVELLE_NOTE : " + NOUVELLE_NOTE);
		console.log ("distanceEnDemiTon(TONALITE, NOUVELLE_NOTE) : " + distanceEnDemiTon(TONALITE, NOUVELLE_NOTE));
	*/
    var FINAL = NOUVELLE_NOTE;
    if (DIFFERENCE === 1) {
        FINAL += "#";
    } else if (DIFFERENCE === 2) {
        FINAL += "##";
    } else if (DIFFERENCE === -1) {
        FINAL += "b";
    } else if (DIFFERENCE === -2) {
        FINAL += "bb";
    }
	return FINAL;
  }

  function REAL_ACCORD(TONALITE, DEGRE) { // On trouve l'accord correspondant au degré DEGRE de la tonalité TONALITE
    var degreElement;
	/*	
		console.log("Nouveau degré : " + DEGRE);
    */
	for (var i = 0; i < LISTE_DEG.length; i++) {	//On récupère le degré dans LISTE_DEG, avec les informations correspondantes : nombre de déplacements de note, distance en demi-tons
        if (LISTE_DEG[i][0] === DEGRE.toUpperCase()) {
            degreElement = LISTE_DEG[i];
            break;
        }
    }
	var FINAL = DEPLACER_NOTE(TONALITE, degreElement[1], degreElement[2]);
    if (DEGRE === DEGRE.toLowerCase()) {
        FINAL += "m";
    }
    return FINAL;
  }

  function REAL_CADENCE(TONALITE, CADENCE) {
    var SUITE_COMPLETE = "";
    var ACCORDS = CADENCE.split(" ");
    for (var i = 0; i < ACCORDS.length; i++) {
        SUITE_COMPLETE += REAL_ACCORD(TONALITE, ACCORDS[i]) + " ";
    }
    return SUITE_COMPLETE;
  }

  function NEWCADENCE() {
    GTONALITE = TNOTES[Math.floor(Math.random() * TNOTES.length)];
    GCADENCE = TCADENCES[Math.floor(Math.random() * TCADENCES.length)];
	/* Debugging
	GTONALITE = TNOTES[14];
	GCADENCE = TCADENCES[12];
	*/
	//if GCADENCE
	console.log("AVANT, tonalité : " + GTONALITE + ", cadence : " + GCADENCE);
	if (GCADENCE[0][0] === "i") { // Si la cadence est mineure, on veut la note qui se situe neuf demi-tons au-dessus de GTONALITE
		GTONALITE = DEPLACER_NOTE(GTONALITE, 5, 9); // on ne veut pas un accord mais une note
		if (GTONALITE === "D#") {	// au cas où on choisirait D#m, une chance sur deux de la remplacer par Ebm
			if (Math.random() < 0.5) { GTONALITE = "Eb"; }
			}
		console.log ("Mineure ! Nouvelle tonalité : " + GTONALITE);
	}
    GCAD_REAL = REAL_CADENCE(GTONALITE, GCADENCE[0]);
    document.getElementById("cadence").innerHTML = GCAD_REAL;
  }

  function checkTonaliteCadence() {
    var tonaliteSelection = document.getElementById("tonaliteSelection").value;
    var cadenceSelection = document.getElementById("cadenceSelection").value;
    if (tonaliteSelection === GTONALITE && cadenceSelection === GCADENCE[0]) {
		document.getElementById("information").innerHTML = "<b><center>BRAVO !</center></b><br><u>Accords :</u> <b>" + GCAD_REAL + "</b><br><u>Cadence :</u> <b>" + GCADENCE[0] + "</b>, tonalité <b>" + GTONALITE + "</b><br>" + GCADENCE[1];
		document.getElementById("information").style.backgroundColor = "green";
		NEWCADENCE();
} else {
		document.getElementById("information").style.backgroundColor = "red";
		document.getElementById("information").innerHTML = "<br><br><br><b><center>ERREUR !</center></b>";
}
}

  function reponse() {
		document.getElementById("information").innerHTML = "<u>Accords :</u> <b>" + GCAD_REAL + "</b><br><u>Cadence :</u> <b>" + GCADENCE[0] + "</b>, tonalité <b>" + GTONALITE + "</b><br>" + GCADENCE[1];
		document.getElementById("information").style.backgroundColor = "grey";
		NEWCADENCE();
}
</script>
 <head>
  <style>
    body {
           display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
	a {
		font-weight: bold;
	}
    #cadence {
        font-size: 100px;
		font-weight: bold;
      }
      label, select, button {
        font-size: 30px;
      }
      #information {
        font-size: 30px;
		 background-color: grey;
	 text-align: left;
	   height: 40vh; /* adjust as needed */
      width: 80vw; /* adjust as needed */
      overflow: auto; /* to enable scroll if more than 6 lines */
      }
    @media (max-width:800px) {
	 #cadence {
      font-size: 10vw;
      font-weight: bold;
    }
    label, select, button {
      font-size: 5vw;
    }
    #information {
	 text-align: left;
	 font-size: 4vw;
      height: 30vh; /* adjust as needed */
      width: 80vw; /* adjust as needed */
      overflow: auto; /* to enable scroll if more than 6 lines */
    }
     
    }
  </style>
</head>
<body onload="NEWCADENCE()">
  <div id="cadence"></div>
  <div>
    <br>
    <label for="tonaliteSelection">Sélectionnez la tonique :</label>
    <select id="tonaliteSelection">
      <option value="Cb">Cb</option>
      <option value="C">C</option>
      <option value="C#">C#</option>
      <option value="Db">Db</option>
      <option value="D">D</option>
	  <option value="D">D#</option>
      <option value="Eb">Eb</option>
      <option value="E">E</option>
      <option value="F">F</option>
      <option value="F#">F#</option>
      <option value="Gb">Gb</option>
      <option value="G">G</option>
      <option value="Ab">Ab</option>
      <option value="A">A</option>
      <option value="Bb">Bb</option>
      <option value="B">B</option>
    </select>
    <br>
    <br>
    <label for="cadenceSelection">Sélectionnez le parcours harmonique :</label>
	
    <select id="cadenceSelection">
		<SCRIPT>
		for (i = 0; i < TCADENCES.length; i++)
		{
			document.write ("<option value='" + TCADENCES[i][0] + "'>" + TCADENCES[i][0] + "</option>");
		}
	  </SCRIPT>
    </select>
  </div>
  <div>
    <br>
    <br>
   <center> <button onclick="checkTonaliteCadence()">Vérifier</button> <button onclick="reponse()">Réponse</button><br><br>
    <div id="information"></div>
  </div>
</body>
</html>

 